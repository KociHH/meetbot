# MeetBot - Бот для знакомств

## Зачем нужен этот бот?
MeetBot — это Telegram-бот, разработанный для упрощения процесса знакомств и общения между пользователями. Он предлагает два основных режима поиска собеседников, позволяя пользователям находить новые контакты как в приватных беседах, так и в групповых чатах.

## Основные функции
1.  **Поиск собеседника (один на один)**:
    *   Бот подбирает одного собеседника.
    *   После нахождения потенциального партнера бот отправляет предложение обоим пользователям.
    *   Если оба пользователя согласны на общение, бот предоставляет ссылку на профиль партнера.
    *   В случае отказа или истечения времени ожидания, встреча отменяется.

2.  **Групповой поиск (от 4 человек)**:
    *   Бот помогает формировать группы для общения.
    *   Пользователи указывают желаемое количество участников (минимум 4).
    *   После формирования группы бот присылает ссылку-приглашение в созданный чат.
    *   Предусмотрен механизм отслеживания активности чатов; неактивные чаты могут быть автоматически очищены.

## Технологии, применяемые в проекте

| Библиотека/Технология | Реализация в проекте |
|-----------------------|----------------------------------------------------------|
| `aiogram`             | Основной фреймворк для построения логики Telegram-бота, обработки сообщений и колбэков. |
| `FastAPI`             | Используется для создания вебхуков, обеспечивающих взаимодействие бота с Telegram API. |
| `Celery`              | Асинхронная очередь задач для реализации сложных фоновых процессов, таких как: <br/> - Алгоритмы матчмейкинга (подбор одиночных и групповых чатов). <br/> - Мониторинг поиска пользователей и таймаутов. <br/> - Анимация статуса поиска для пользователей. <br/> - Перемещение неактивных пользователей в MongoDB. |
| `kos_Htools`          | Упрощенная работа с `Telethon` и `Redis`. Предоставляет удобные обертки для взаимодействия с Redis (`RedisShortened`) и для создания приватных групп Telegram через `Telethon`. |
| `asyncio`             | Используется для написания асинхронного кода, позволяющего боту эффективно обрабатывать множество одновременных запросов без блокировки. |
| `Telethon`            | Используется через `kos_Htools` для программного создания приватных групп Telegram и управления ими, что является ключевым для функции группового поиска. |
| `SQLAlchemy`          | ORM (Object-Relational Mapper) для взаимодействия с базой данных PostgreSQL. Используется для хранения информации о пользователях (`User`), приватных чатах (`PrivateChats`) и настройках поиска пользователей (`SearchUser`). |
| `Redis`               | Используется как кэш для быстрой работы алгоритмов подбора пользователей в реальном времени. Хранит временные данные о пользователях в поиске, состояния комнат и очереди. |
| `PyMongo`             | Драйвер для взаимодействия с базой данных MongoDB. Используется для архивирования данных неактивных пользователей (`party_searchers`, `many_searchers`). |
| `PostgreSQL`          | Реляционная база данных для постоянного хранения информации о пользователях, созданных чатах и их параметрах. |
| `MongoDB`             | Документоориентированная база данных для хранения данных о неактивных пользователях, освобождая Redis от "холодных" данных. |

## Структура проекта

*   `main.py`: Точка входа в приложение, инициализация бота, вебхуков и подключений к базам данных.
*   `commands/`: Содержит логику обработки команд, сообщений и колбэков:
    *   `basic_command.py`: Основные команды, панель администратора, запуск поиска.
    *   `inline_handlers.py`: Обработка встроенных кнопок и логика взаимодействия пользователей.
    *   `message_bot.py`: Обработка текстовых сообщений, связанных с поиском и настройками.
    *   `state.py`: Определение состояний FSM (`aiogram.fsm.state.StatesGroup`) для управления диалогами с пользователем.
*   `data/`: Управление данными и подключением к базам данных:
    *   `celery/`: Конфигурация Celery и определение асинхронных задач.
    *   `middleware/`: Промежуточное ПО для управления сессиями базы данных.
    *   `mongo/`: Конфигурация MongoDB.
    *   `redis_instance.py`: Инициализация и управление экземплярами Redis.
    *   `sqlchem.py`: Определение моделей SQLAlchemy и схемы базы данных PostgreSQL.
*   `keyboards/`: Модули для создания различных типов клавиатур (ReplyKeyboard, InlineKeyboard) и определения названий кнопок.
*   `utils/`: Вспомогательные функции:
    *   `celery_tools.py`: Основная логика матчмейкинга, взаимодействия с Telethon для создания групп, а также методы для управления данными в Redis.
    *   `dataclass.py`: Датаклассы для удобного хранения информации о пользователях.
    *   `other.py`: Различные служебные функции, включая логирование, отправку сообщений и обработку невидимых символов в никнеймах.
    *   `time.py`: Функции для работы со временем, включая преобразование часовых поясов.
    *   `words_or_other.py`: Константы, такие как невидимые символы и эмодзи.

## Запуск проекта

Для запуска проекта необходимо:
1.  Клонировать репозиторий.
2.  Установить зависимости из `requirements.txt`.
3.  Настроить переменные окружения в `config.py` (токен бота, URL вебхука, данные для подключения к базам данных).
4.  Запустить бота (с вебхуками или в режиме polling).

## Запуск с использованием Docker

Для запуска проекта в Docker-контейнерах выполните следующие шаги:

1.  **Соберите Docker-образы**: В корневой директории проекта выполните команду для сборки образов, определенных в `docker-compose.yml`:

    ```bash
    docker-compose build
    ```

2.  **Запустите контейнеры**: После успешной сборки образов запустите все сервисы, определенные в `docker-compose.yml`, в фоновом режиме:

    ```bash
    docker-compose up -d
    ```

# Проект пока является не законченным!